package xxhash

import (
	"bytes"
	"testing"
)

const sanityPrime = 0x9e3779b1

func newSanityBuf(tb testing.TB) []byte {
	tb.Helper()
	buf := make([]byte, 101)
	tmp := sanityPrime
	for i := range buf {
		buf[i] = byte(tmp >> 24)
		tmp *= tmp
	}
	return buf
}

func TestSanityBuf(t *testing.T) {
	sanityBuf := newSanityBuf(t)
	golden := []byte{
		0x9e, 0xff, 0x1f, 0x4b, 0x5e, 0x53, 0x2f, 0xdd, 0xb5, 0x54,
		0x4d, 0x2a, 0x95, 0x2b, 0x57, 0xae, 0x5d, 0xba, 0x74, 0xe9,
		0xd3, 0xa6, 0x4c, 0x98, 0x30, 0x60, 0xc0, 0x80, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00,
	}
	if !bytes.Equal(sanityBuf, golden) {
		t.Fatalf("got %x, want %x", sanityBuf, golden)
	}
}
